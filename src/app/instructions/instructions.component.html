<nav class="navbar navbar-light bg-primary sticky-top">
  <div class="container-fluid">
    <form class="d-flex input-group">
      <input [ngModel]="filter" [ngModelOptions]="{standalone: true}" (ngModelChange)="filterChanged($event)" type="text" placeholder="Searchâ€¦" class="form-control" aria-label="Search">
    </form>
  </div>
</nav>

<div class="container">
  <h2>Instructions</h2>

  <p>
    These are the WebAssembly SIMD instructions; if you're working in a
    higher-level language like C or C++ you'll likely want to look at
    the <a routerLink="/intrinsics">intrinsics</a> or
    <a routerLink="/wav">WAV functions</a> instead.
  </p>
</div>

<div class="container">
  <div class="accordion accordian-flush">
    <div *ngFor="let instruction_name of instructionList" class="accordion-item">
      <div *ngFor="let instruction of [instructions.getInstruction(instruction_name)!]">
        <h2 class="accordion-header" [id]="instructions.instructionId(instruction)">
          <button class="accordion-button" [ngClass]="{ 'collapsed': !instructionDetailsVisible.get(instruction_name) }" (click)="toggleInstructionDetailsVisible(instruction_name)" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse-' + instructions.instructionId(instruction)" [attr.aria-controls]="'#collapse-' + instructions.instructionId(instruction)">
            <div class="item-header">
              <code>
                <em class="item-name fw-bold">
                  {{ instruction.name }}
                  (<ol class="function-parameters comma-separated">
                    <li *ngFor="let param of instruction.params">
                      {{ param.name }}: {{ param.type }}
                    </li>
                  </ol>)
                  ->
                  {{ instruction.return }}
                </em>
              </code>
              <span class="item-title">{{ instruction.title }}</span>
            </div>
          </button>
        </h2>

        <div class="accordion-collapse" *ngIf="instructionDetailsVisible.get(instruction_name)" [attr.aria-labelledby]="instructions.instructionId(instruction)">
          <div class="accordion-body">
            <h3>Description</h3>

            <markdown [data]="instruction.description"></markdown>

            <p *ngIf="instruction.simde">
              View <a [href]="instruction.simde">implementation
              <i class="fas fa-external-link-alt"></i></a> of
              corresponding intrinsic in SIMDe.
            </p>

            <h3>APIs</h3>

            <section>
              <h4>WAV Functions</h4>

              <p>
                This doesn't include the overloaded aliases yet (i.e.,
                <code>wav_{{ instruction.family_name }}()</code>).
              </p>

              <ul>
                <li *ngFor="let fn of instruction.wav">
                  <code class="function-prototype">
                    <span class="function-return-type">{{ fn.return }}</span>&nbsp;
                    <em class="function-name fw-bold">{{ fn.name }}</em>
                    (<ol class="function-parameters comma-separated">
                      <li *ngFor="let param of fn.params" class="function-parameter">
                        <span class="function-parameter-type">{{ param.type }}</span>&nbsp;<span class="function-parameter-name">{{ param.name }}</span>
                      </li>
                    </ol>);
                  </code>
                </li>
              </ul>
            </section>

            <section>
              <h4>Intrinsics</h4>

              <ul>
                <li *ngFor="let fn of instruction.intrin">
                  <code class="function-prototype">
                    <span class="function-return-type">{{ fn.return }}</span>&nbsp;
                    <em class="function-name fw-bold">{{ fn.name }}</em>
                    (<ol class="function-parameters comma-separated">
                      <li *ngFor="let param of fn.params" class="function-parameter">
                        <span class="function-parameter-type">{{ param.type }}</span>&nbsp;<span class="function-parameter-name">{{ param.name }}</span>
                      </li>
                    </ol>);
                  </code>
                </li>
              </ul>
            </section>

            <section *ngIf="instruction.lowering">
              <h3>Lowering</h3>

              <div class="alert alert-warning" role="alert">
                <h5><i class="fas fa-exclamation-triangle"></i> Possibly inaccurate!</h5>
                <hr />
                <p>
                  The lowering information here may not be accurate yet since we're still
                  relying on autovectorization from the compiler for many implementations.
                  We're working on adding optimized versions, but until we do there is a
                  good chance these numbers are (significantly) higher than what you can
                  expect from an optimized implementation like you'll find in Chrome or
                  Firefox.
                </p>

                <p>
                  If you're interested in helping, see
                  <a href="https://github.com/simd-everywhere/simde/issues/776">
                  <i class="fab fa-github"></i> simde-everywhere/simde#776</a>.
                  Any changes made to <a [href]="instruction.simde">the implementation
                  in SIMDe <i class="fas fa-external-link-alt"></i></a> will quickly find
                  their way onto this site .
                </p>
              </div>

              <section *ngFor="let arch of instruction.lowering">
                <h4>{{ arch.arch }}</h4>

                <section *ngFor="let option of arch.options">
                  <h5>{{ option.option }}</h5>

                  <div *ngFor="let impl of option.implementations">
                    <h6 *ngIf="impl.immediates && (option.implementations.length > 1)">
                      Immediate value<span *ngIf="impl.immediates.length > 1">s</span>:
                      <ol class="comma-separated">
                        <li *ngFor="let imm of impl.immediates">{{ imm }}</li>
                      </ol>
                    </h6>

                    <table class="table table-striped table-hover">
                      <thead>
                        <tr>
                          <th>Instruction</th>
                          <th>Parameters</th>
                          <th>uOps</th>
                          <th>Latency</th>
                        </tr>
                      </thead>

                      <tbody>
                        <tr *ngFor="let inst of impl.instructions">
                          <td>{{ inst.name }}</td>
                          <td>
                            <ol class="comma-separated">
                              <li class="d-inline" *ngFor="let arg of inst.arguments">{{ arg }}</li>
                            </ol>
                          </td>
                          <td>{{ inst.uops }}</td>
                          <td>{{ inst.latency }}</td>
                        </tr>
                      </tbody>

                      <tfoot>
                        <tr>
                          <th colspan="2">Total</th>
                          <td>{{ instructions.sumOps(impl) }}</td>
                          <td>{{ instructions.sumLatency(impl) }}</td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </section>
              </section>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
